/*********************************************************************
	Copyright (C) 2016 JLin Liu. All rights reserved.  
	                                                                 
	> File Name:		< hellovideo.cpp >
	> Author:		< JLin Liu >
	> Mail:			< Liu_JLin@outlook.com >
	> Created Time:		< 2016/02/26 >
	> Last Changed:  
	> Description:  	from Opencv/Documents/opencv2reman Page9
				opencv调用摄像头采集图像，
				VideoCapture 的用法
************************************************************************/ 
 
 
#include <iostream>

#include <cv.h>
//#include <highgui.h>
//#include<core/core.hpp>
//#include<imgproc/imgproc.hpp>
#include<opencv2/highgui/highgui.hpp>

//#define NAME_cpp " Flip_Image "
using namespace cv;  
using namespace std; 

int process(void)
{
	int n = 0;
	char filename[200];
	cout << "press space to save a picture. q or esc to quit" << endl;
	//namedWindow(window_name, CV_WINDOW_KEEPRATIO);
	
	if (frame.empty())
		break;
	switch (key)
	{
		case 'q':
		case 'Q':
		case 27:return 0;
		case ' ':
			sprintf(filename,"filename%.3d.jpg",n++);
			imwrite(filename,frame);
			cout << "Saved " << filename << endl;
			break;
		default:
			break;
	}
			
	return 0;
}


int main( int argc, char** argv )
{
	VideoCapture cap(1);                  //VideoCapture cap(0)调用电脑默认摄像头；VideoCapture cap(1)调用外部usb摄像头
	if(!cap.isOpened()) return -1;

	Mat frame, edges;
	namedWindow("edges",1);
	for(;;)
	{
		cap >> frame;
		cvtColor(frame, edges, CV_BGR2GRAY);
	//	GaussianBlur(edges, edges, Size(7,7), 1.5, 1.5);
		Canny(edges, edges, 0, 30, 3);
		imshow("edges", edges);
		if(waitKey(30) >= 0) break;
		
		return process();
	}
	/*IplImage* pFrame = NULL;
	VideoCapture* pCapture = createCameraCapture(-1);
	namedWindow("video",1);

	while(1)
	{
		pFrame = cvQueryFrame( pCapture );
		if( !pFrame )break;
		imshow("video",pFrame);
		char c=waitkey(33);
		if(c==27)break;
	}
	releaseCapture(&pCapture);
	destroyWindow("video");*/

	return 0;
}
